<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Brevet Clock</title>
    <style>table{border-collapse:collapse;font-size:x-large;border-style:ridge;}
    td{border-color:lightgray;border-width:5px;border-style:ridge;align:center;}
    .select{font-size:x-large;background:peachpuff;border:2px solid sandybrown;border-radius:4px;padding:2px;}
    .addDel{font-size:x-large;background:peachpuff;border:2px solid sandybrown;border-radius:4px;padding:2px;}
    .tablinks{font-size:x-large;border:3px solid gray;border-radius:6px;padding:6px;}
    .oddline{text-align:center;background-color:wheat;}
    .evenline{text-align:center;background-color:khaki;}
    .timeOver{text-align:center;background-color:yellow;color:red;}
    font-size:x-large;
    </style>
</head>
<body>

    
    
<!-- Tab links -->
<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Setting')" id="defaultOpen"> 출발 설정 </button>&nbsp;&nbsp;
  <button class="tablinks" onclick="openTab(event, 'displayTimer')"> 경과시간 표시 </button>&nbsp;&nbsp;
  <button class="tablinks" onclick="openTab(event, 'etcEtc')"> 기타 </button>
</div>

<br />
<!-- Tab content -->
<div id="Setting" class="tabcontent">
<br />
<div class="selectBox">
<table width="100%">
<tr><td align="center" colspan=3><label for="brevetKind">브레베 종류 </label>
  <select name="brevetKind" id="brevetKind" class="select">
  <option value="13.5">200km</option>
  <option value="20">300km</option>
  <option value="30">400km</option>
  <option value="40">600km</option>
  <option value="75">1000km</option>
  <option value="90">1200km</option>
  <option value="24">Flash</option>
  </select></td></tr>
<tr><td align="center" colspan=3><label for="startGap">출발간격 </label>
  <select name="startGap" id="startGap" class="select">
  <option value="0">동시 출발</option>
  <option value="60">1시간 간격</option>
  <option value="30">30분 간격</option>
  <option value="20">20분 간격</option>
  <option value="15">15분 간격</option>
  <option value="10">10분 간격</option>
</td></tr>
<tr align=center><td><label for="year"></label>
  <select name="year" id="year" class="select">
  <option value="2024">2024</option>
  <option value="2025">2025</option>
  <option value="2026">2026</option>
  <option value="2027">2027</option>
</select> 년</td>

  <td><label for="month"></label>
  <select name="month" id="month" class="select">
  <option value="0">1</option>
  <option value="1">2</option>
  <option value="2">3</option>
  <option value="3">4</option>
  <option value="4">5</option>
  <option value="5">6</option>
  <option value="6">7</option>
  <option value="7">8</option>
  <option value="8">9</option>
  <option value="9">10</option>
  <option value="10">11</option>
  <option value="11">12</option>
</select> 월</td>
    
  <td><label for="date"></label>
  <select name="date" id="date" class="select">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
  <option value="16">16</option>
  <option value="17">17</option>
  <option value="18">18</option>
  <option value="19">19</option>
  <option value="20">20</option>
  <option value="21">21</option>
  <option value="22">22</option>
  <option value="23">23</option>
  <option value="24">24</option>
  <option value="25">25</option>
  <option value="26">26</option>
  <option value="27">27</option>
  <option value="28">28</option>
  <option value="29">29</option>
  <option value="30">30</option>
  <option value="31">11</option>
</select> 일</td></tr>

<tr align=center><td></td><td>
  <label for="hour"></label>
  <select name="hour" id="hour" class="select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
  <option value="16">16</option>
  <option value="17">17</option>
  <option value="18">18</option>
  <option value="19">19</option>
  <option value="20">20</option>
  <option value="21">21</option>
  <option value="22">22</option>
  <option value="23">23</option>
</select> 시</td>

  <td><label for="minute"></label>
  <select name="minute" id="minute" class="select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">11</option>
  <option value="12">12</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
  <option value="16">16</option>
  <option value="17">17</option>
  <option value="18">18</option>
  <option value="19">19</option>
  <option value="20">20</option>
  <option value="21">21</option>
  <option value="22">22</option>
  <option value="23">23</option>
  <option value="24">24</option>
  <option value="25">25</option>
  <option value="26">26</option>
  <option value="27">27</option>
  <option value="28">28</option>
  <option value="29">29</option>
  <option value="30">30</option>
  <option value="31">31</option>
  <option value="32">32</option>
  <option value="33">33</option>
  <option value="34">34</option>
  <option value="35">35</option>
  <option value="36">36</option>
  <option value="37">37</option>
  <option value="38">38</option>
  <option value="39">39</option>
  <option value="40">40</option>
  <option value="41">41</option>
  <option value="42">42</option>
  <option value="43">43</option>
  <option value="44">44</option>
  <option value="45">45</option>
  <option value="46">46</option>
  <option value="47">47</option>
  <option value="48">48</option>
  <option value="49">49</option>
  <option value="50">50</option>
  <option value="51">51</option>
  <option value="52">52</option>
  <option value="53">53</option>
  <option value="54">54</option>
  <option value="55">55</option>
  <option value="56">56</option>
  <option value="57">57</option>
  <option value="58">58</option>
  <option value="59">59</option>
</select> 분</td></tr>
</table>
</div>
</div>

<div id="displayTimer" class="tabcontent">
<br />
  &nbsp;&nbsp;<button class="addDel" onclick="addEntry(event, 1)" >&nbsp;출발 추가&nbsp;</button>&nbsp;&nbsp;
  <button class="addDel" onclick="addEntry(event, -1)" >&nbsp;출발 삭제&nbsp;</button>
<br />
<br />
<br />
<table width="100%" align="left">
<colgroup><col style="background:khaki;"></colgroup>
  <tr class="oddline"><td>출발 시간</td><td id="start" style="color:black;">.</td></tr>
  <tr class="evenline"><td>현재 시간</td><td id="current" style="color:blue;">.</td></tr>
</table>
<div style="height:100px;">&nbsp;</div>

<table width="100%" align="left" id="statusTable">
  <tr class="oddline"><td>출발</td><td>마감</td><td>경과</td><td>남음</td></tr>
  <tr class="evenline"><td>.</td><td></td><td></td><td></td></tr>
</table>
</div>

<div id="etcEtc" class="tabcontent">
  <h3>기타</h3>
  <p>기타 표시 영역.</p>
</div>



 <script>
function buildTimeStr(start, now, limit, elem) {
    var m = start.getMonth();
    var d = start.getDate();
    var h = start.getHours();
    var min = start.getMinutes();
    var disp = `${h}:${min<10?`0${min}`:min}`
    elem.cells[0].innerText=disp;

    var ms = start.getTime()+limit*60*60000;
    var newTime = new Date(ms);
    h=newTime.getHours();
    min =newTime.getMinutes(); 
    elem.cells[1].innerText=`${h}:${min<10?`0${min}`:min}`;

    var delta = diffGetTime(start, now);
    h = Math.floor(delta/3600);
    min = Math.floor((delta-h*3600)/60);
    //s = d%60;
    disp=`${h}:${min<10?`0${min}`:min}`;
    elem.cells[2].innerText = disp;
    
    limit=limit*3600+60;
    delta = limit-delta;
    if (delta<0) {
        delta=-delta+60;
        var sign="-";
        elem.className="timeOver";
    } else {
      var sign="";
    }
    h = Math.floor(delta/3600);
    min = Math.floor((delta-h*3600)/60);
    elem.cells[3].innerText=sign+`${h}:${min<10?`0${min}`:min}`;
}

function addEntry(event, how) {
  const table = document.getElementById('statusTable');
  const minLen = 3;
  const maxLen =20;
  var len = table.rows.length;
  
  if (how==1 && len<maxLen) {
    const sDiff = document.getElementById('startGap').value;
    if (sDiff==0) {
      return;
    }
    const newRow = table.insertRow(len);
    if (len%2) {
        newRow.className="oddline";
    } else {
        newRow.className="evenline";
    }
    
    const newCell1 = newRow.insertCell(0);
    newRow.insertCell(1);
    newRow.insertCell(2);
    newRow.insertCell(3);
    newCell1.innerText = '.';
    
    callClock();
    return;
  }
  
  if (how==-1 && len > minLen) {
    table.deleteRow(len-1);
  }
}

function callClock() {
    var now = new Date();
    var yy = document.getElementById("year").value;
    var mm = Number(document.getElementById("month").value);
    var dd = document.getElementById("date").value;
    var hh = document.getElementById("hour").value;
    var min = document.getElementById("minute").value;

    startTime = new Date(yy,mm, dd, hh, min);
    document.getElementById("start").innerText =` ${mm+1}월 ${dd}일 ${hh<10?`0${hh}`:hh}:${min<10?`0${min}`:min}:00`;
    
    var month = now.getMonth();
    var date = now.getDate();
    var hours = now.getHours();
    var minutes = now.getMinutes();
    var seconds = now.getSeconds();

    document.getElementById("current").innerText = 
    ` ${month+1}월 ${date}일 ${hours<10?`0${hours}`:hours}:${minutes<10?`0${minutes}`:minutes}:${seconds<10?`0${seconds}`:seconds}`;
    
    const table = document.getElementById('statusTable');
    const len = table.rows.length; 
    const sDiff = document.getElementById('startGap').value;
    const limitTime = document.getElementById('brevetKind').value;
    for (i=2;i<len;i++) {
      if (i%2) {
        table.rows[i].className="oddline";
      } else {
        table.rows[i].className="evenline";
      }
      var ms = startTime.getTime() + sDiff*(i-2)*60000;
      //var ms = startTime.getTime()+1000;
      var newTime = new Date(ms);
      buildTimeStr(newTime,now,limitTime,table.rows[i]);
    }
}

function diffGetTime(date1, date2) {
  var diff = (date2.getTime() - date1.getTime())/1000;
  return Math.floor(diff);
}

function initStartTime() {
    var now = new Date();
    
    var year = now.getFullYear();
    var month = now.getMonth();
    var date = now.getDate();
    var hour = 6;
    var minute = 0;
    startTime = new Date(year,month,date,hour,minute);
    
    document.getElementById("year").value = year;
    document.getElementById("month").value = month;
    document.getElementById("date").value = date;
    document.getElementById("hour").value = hour;
    document.getElementById("minute").value = minute;

    document.getElementById("startGap").value = 30;
}
    
function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
    tablinks[i].style.backgroundColor = "gray";
  }

  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
  evt.currentTarget.style.backgroundColor = "yellow";
}        

    
let startTime = new Date();

document.getElementById("defaultOpen").click();
initStartTime();
callClock();

document.getElementById("statusTable").insertRow(0);

setInterval(callClock, 1000); // 1초마다 실행
</script>
</body>
</html>
